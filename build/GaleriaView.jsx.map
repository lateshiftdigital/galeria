{"version":3,"file":"GaleriaView.jsx","sourceRoot":"","sources":["../src/GaleriaView.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client'\nimport {\n  useState,\n  useId,\n  ComponentProps,\n  useRef,\n  useEffect,\n  useContext,\n  useLayoutEffect,\n  isValidElement,\n  cloneElement,\n} from 'react'\nimport { createPortal } from 'react-dom'\n\nimport { GaleriaViewProps } from './Galeria.types'\nimport type Native from './GaleriaView.ios'\n\nimport { LayoutGroup, motion } from 'framer-motion'\nimport { GaleriaContext } from './context'\n\nfunction Image({\n  __web,\n  index = 0,\n  children,\n  style,\n  dynamicAspectRatio = false,\n}: GaleriaViewProps) {\n  const [isOpen, setIsOpen] = useState(false)\n  const { urls, theme } = useContext(GaleriaContext)\n  const url = urls?.[index]\n  const parentRef = useRef<HTMLDivElement>()\n  const [aspectRatio, setAspectRatio] = useState(1)\n  const id = useId()\n  const getFirstImageChild = (node: Node) => {\n    if (node.nodeType === 1 && node.nodeName === 'IMG') {\n      return node\n    }\n    if (node.childNodes) {\n      return getFirstImageChild(node.childNodes[0])\n    }\n    return null\n  }\n  const getNodeAspectRatio = (node: Node) => {\n    const imageNode = getFirstImageChild(node)\n    if (imageNode) {\n      return (\n        imageNode.getBoundingClientRect().height /\n        imageNode.getBoundingClientRect().width\n      )\n    }\n    return 1\n  }\n  const [windowDimensions, setWindowDimensions] = useState()\n  const onClick = (e) => {\n    const imageNode = getFirstImageChild(e.target as Node)\n    if (imageNode) {\n      setIsOpen(true)\n      const ratio = getNodeAspectRatio(imageNode)\n      setAspectRatio(ratio)\n      if (\n        typeof process != 'undefined' &&\n        typeof process.env != 'undefined' &&\n        process?.env?.NODE_ENV === 'development'\n      ) {\n        const nodeAspectRatio = getNodeAspectRatio(imageNode)\n\n        if (nodeAspectRatio !== ratio) {\n          console.error(\n            `[galeria] Galeria.Image does not have the same aspect ratio as its child.\n            \nThis might result in a weird animation. To fix it, pass the \"style\" prop to Galeria.Image to give it the same height & width as the image.`,\n          )\n        }\n      }\n    }\n  }\n  const isHorizontal = Number(aspectRatio >= 1).toFixed(4)\n  return (\n    <>\n      <motion.div\n        style={{ zIndex: index, ...style } as object}\n        // faster than onClick\n        onMouseDown={onClick}\n        onTouchStart={onClick}\n        layoutId={id}\n      >\n        {isValidElement(children)\n          ? cloneElement(children, { draggable: false } as object)\n          : children}\n      </motion.div>\n\n      <PopupModal visible={isOpen} onClose={() => setIsOpen(false)}>\n        {url ? (\n          <motion.img\n            layoutId={id}\n            style={{\n              ...(dynamicAspectRatio\n                ? {}\n                : {\n                    ...(isHorizontal\n                      ? {\n                          width: `100%`,\n                          aspectRatio,\n                        }\n                      : {\n                          height: '100%',\n                          aspectRatio,\n                        }),\n                  }),\n              objectFit: 'cover',\n              zIndex: 2000,\n            }}\n            src={url as string}\n          ></motion.img>\n        ) : null}\n      </PopupModal>\n    </>\n  )\n}\n\nfunction Root({\n  children,\n  urls,\n  theme = 'light',\n  ids,\n}: ComponentProps<typeof Native>) {\n  const [openState, setOpen] = useState({\n    open: false,\n  } as\n    | {\n        open: false\n      }\n    | {\n        open: true\n        src: string\n        initialIndex: number\n      })\n  return (\n    <GaleriaContext.Provider\n      value={{\n        setOpen,\n        urls,\n        theme,\n        ...(openState.open\n          ? {\n              open: true,\n              src: openState.src,\n              initialIndex: openState.initialIndex,\n            }\n          : {\n              open: false,\n              src: '',\n              initialIndex: 0,\n            }),\n        ids,\n      }}\n    >\n      <LayoutGroup inherit={false} id={useId()}>\n        {children}\n      </LayoutGroup>\n    </GaleriaContext.Provider>\n  )\n}\n\nfunction PopupModal({\n  visible,\n  children,\n  onClose,\n}: {\n  visible: boolean\n  children: React.ReactNode\n  onClose: () => void\n}) {\n  const elementRef = useRef<HTMLDivElement | null>(null)\n  if (typeof window !== 'undefined' && !elementRef.current) {\n    const element = document.createElement('div')\n    element.setAttribute('galeria-popup', 'hello-inspector')\n\n    if (element && document.body) {\n      document.body.appendChild(element)\n      elementRef.current = element\n    }\n  }\n\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useEffect(function cleanup() {\n    return () => {\n      if (document.body && elementRef.current) {\n        document.body.removeChild(elementRef.current)\n        elementRef.current = null\n      }\n    }\n  }, [])\n\n  // for radix menus, which glitch a lot with regular modals on RNW\n  if (!visible) return null\n  const node = (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        zIndex: 100,\n      }}\n      onClick={onClose}\n    >\n      {children}\n    </div>\n  )\n  return elementRef.current ? createPortal(node, elementRef.current) : null\n}\n\nconst Galeria: typeof Native = Object.assign(Root, {\n  Image,\n  Popup: () => null,\n})\n\nexport default Galeria\n"]}